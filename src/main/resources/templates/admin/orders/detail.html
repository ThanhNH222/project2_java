<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Chi ti·∫øt ƒë∆°n thu√™ xe</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/admin.css}">

</head>
<body>
<!--<body class="bg-light py-4">-->

<div class="sidebar">
    <h4 class="text-white mb-4">üöó Car Rental</h4>
    <a href="/admin">üìä Dashboard</a>
    <a href="/admin/cars">üöò Cars</a>
    <a href="/admin/orders" class="active">üë• Rental Order</a>
</div>

<div class="container">
    <!-- Ti√™u ƒë·ªÅ -->
    <h1 class="mb-4">Chi ti·∫øt ƒë∆°n thu√™ #<span th:text="${order.id}"></span></h1>

    <!-- H√†ng 1: Th√¥ng tin + Ghi ch√∫ -->
    <div class="row g-4">
        <!-- C·ªôt tr√°i: kh√°ch h√†ng + xe -->
        <div class="col-lg-8">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-dark text-white">Th√¥ng tin kh√°ch h√†ng</div>
                <div class="card-body p-0">
                    <table class="table mb-0">
                        <tr>
                            <th style="width: 30%">H·ªç t√™n</th>
                            <td th:text="${order.customerName}"></td>
                        </tr>
                        <tr>
                            <th>Email</th>
                            <td th:text="${order.customerEmail}"></td>
                        </tr>
                        <tr>
                            <th>S·ªë ƒëi·ªán tho·∫°i</th>
                            <td th:text="${order.customerPhone}"></td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">Th√¥ng tin xe thu√™</div>
                <div class="card-body p-0">
                    <table class="table mb-0">
                        <tr>
                            <th style="width: 30%">T√™n xe</th>
                            <td th:text="${order.car.name}"></td>
                        </tr>
                        <tr>
                            <th>Bi·ªÉn s·ªë</th>
                            <td th:text="${order.car.licensePlate}"></td>
                        </tr>
                        <tr>
                            <th>Ng√†y giao xe</th>
                            <td th:text="${order.pickupDateTime}"></td>
                        </tr>
                        <tr>
                            <th>ƒê·ªãa ch·ªâ giao</th>
                            <td th:text="${order.pickupLocation}"></td>
                        </tr>
                        <tr>
                            <th>Ng√†y tr·∫£ xe</th>
                            <td th:text="${order.dropoffDateTime}"></td>
                        </tr>
                        <tr>
                            <th>ƒê·ªãa ch·ªâ tr·∫£</th>
                            <td th:text="${order.returnLocation}"></td>
                        </tr>
                        <tr>
                            <th>Tr·∫°ng th√°i</th>
                            <td th:text="${order.status}"></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- C·ªôt ph·∫£i: ghi ch√∫ admin -->
        <div class="col-lg-4">
            <div class="card shadow-sm">
                <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                    <span>Ghi ch√∫ c·ªßa Admin</span>
                    <button class="btn btn-sm btn-light" data-bs-toggle="collapse" data-bs-target="#editNotes">
                        ‚úèÔ∏è
                    </button>
                </div>
                <div class="card-body">
                    <!-- Hi·ªÉn th·ªã ghi ch√∫ -->
                    <div th:if="${order.adminNotes != null}">
                        <p th:text="${order.adminNotes}"></p>
                    </div>
                    <div th:if="${order.adminNotes == null}">
                        <em>Ch∆∞a c√≥ ghi ch√∫</em>
                    </div>

                    <!-- Form s·ª≠a/ghi ch√∫ -->
                    <div class="collapse mt-3" id="editNotes">
                        <form th:action="@{/admin/orders/update-notes}" method="post">
                            <input type="hidden" name="orderId" th:value="${order.id}">
                            <textarea class="form-control mb-2" name="adminNotes" rows="4"
                                      th:text="${order.adminNotes}"></textarea>
                            <button class="btn btn-primary btn-sm">L∆∞u</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- H√†ng 2: H·ª£p ƒë·ªìng + ·∫¢nh t√¨nh tr·∫°ng xe -->
    <div class="row g-4 mt-4">
        <!-- H·ª£p ƒë·ªìng -->
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-dark text-white">H·ª£p ƒë·ªìng</div>
                <div class="card-body">
                    <form th:action="@{/admin/orders/upload-contract}" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="orderId" th:value="${order.id}">
                        <div class="mb-3">
                            <label class="form-label">T·∫£i ·∫£nh h·ª£p ƒë·ªìng</label>
                            <input type="file" name="contractImages" multiple class="form-control" accept="image/*">
                        </div>
                        <button class="btn btn-primary">L∆∞u h·ª£p ƒë·ªìng</button>
                    </form>

                    <!-- Hi·ªÉn th·ªã ·∫£nh h·ª£p ƒë·ªìng -->
                    <div class="mt-3" th:if="${#lists.isEmpty(contractImages)}">
                        <em>Ch∆∞a c·∫≠p nh·∫≠t h·ª£p ƒë·ªìng</em>
                    </div>
                    <div class="mt-3" th:if="${!#lists.isEmpty(contractImages)}">
                        <p class="fw-bold">·∫¢nh h·ª£p ƒë·ªìng ƒë√£ k√Ω:</p>
                        <div class="d-flex flex-wrap gap-2">
                            <a th:each="img : ${contractImages}" th:href="@{${img.imageUrl}}" target="_blank">
                                <img th:src="@{${img.imageUrl}}" class="img-thumbnail" style="max-width:150px;">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ·∫¢nh t√¨nh tr·∫°ng xe -->
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">·∫¢nh t√¨nh tr·∫°ng xe</div>
                <div class="card-body">
                    <form th:action="@{/admin/orders/upload-car-images}" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="orderId" th:value="${order.id}">
                        <div class="mb-3">
                            <label class="form-label">·∫¢nh l√∫c giao xe</label>
                            <input type="file" name="handoverImages" multiple class="form-control" accept="image/*">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">·∫¢nh l√∫c nh·∫≠n xe</label>
                            <input type="file" name="returnImages" multiple class="form-control" accept="image/*">
                        </div>
                        <button class="btn btn-secondary">C·∫≠p nh·∫≠t ·∫£nh</button>
                    </form>

                    <!-- Hi·ªÉn th·ªã ·∫£nh ƒë√£ c√≥ -->
                    <div class="mt-3" th:if="${!#lists.isEmpty(handoverImages)}">
                        <p class="fw-bold">·∫¢nh giao xe:</p>
                        <div class="d-flex flex-wrap gap-2">
                            <img th:each="img : ${handoverImages}" th:src="@{${img.imageUrl}}" class="img-thumbnail" style="max-width:150px;">
                        </div>
                    </div>

                    <div class="mt-3" th:if="${!#lists.isEmpty(returnImages)}">
                        <p class="fw-bold">·∫¢nh nh·∫≠n xe:</p>
                        <div class="d-flex flex-wrap gap-2">
                            <img th:each="img : ${returnImages}" th:src="@{${img.imageUrl}}" class="img-thumbnail" style="max-width:150px;">
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>


</div>
<br>
<form th:action="@{/update-status}" method="post">
    <input type="hidden" name="orderId" th:value="${order.id}" />
    <input type="hidden" name="status" value="DELIVERED" />
    <button type="submit" class="btn btn-primary w-100">
        X√°c nh·∫≠n
    </button>
</form>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
